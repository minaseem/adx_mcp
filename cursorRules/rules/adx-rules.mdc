---
description: 
globs: 
alwaysApply: true
---

# Your rule content

- You can @ files here
- You can use markdown but dont have to

# ADX contains following tables

- Log
- User
- PdhPerformanceCube

## Schema and Columns

The following table provides additional detail on each column of the schema in left-to-rightorder of appearance.

### Log Table

| Column Name     | [ADX Type](mdc:https:/docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types) | Description                                                                                                                                                                                                                                                                                                                                                                                                                                      | Required/Notes                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| --------------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| TimeStamp       | datetime                                                                                        | The time relevant to the record, in UTC, with precision to 100's of microseconds (4 decimals). Usually this is the creation time for the record.                                                                                                                                                                                                                                                                                                 | REQUIRED. The client SHOULD specify the timestamp or the dateNow properties of the metric. If both are supplied, dateNow will take precedence. If neither is specified by the client, the gateway MUST use the ingestion time for the metric's TimeStamp                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| RecordType      | string                                                                                          | An enum indicating the "shape" of this record. RecordType indirectly indicates what other columns will be populated.                                                                                                                                                                                                                                                                                                                             | REQUIRED. The client SHOULD specify the recordType property on the metric. If not specified, the gateway MUST set the value to "Log".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Offset          | timespan                                                                                        | The elapsed time since the start of the most recent page load. The Offset of a metric is a direct measurement of when that record's information was created relative to the beginning of the current page.                                                                                                                                                                                                                                       | Optional                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Duration        | timespan                                                                                        | The elapsed time relevant for this metric. For example, Timer metrics will have a duration set to the time since the timer was started.                                                                                                                                                                                                                                                                                                          | Optional                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Level           | string                                                                                          | The importance of this metric, e.g. log level. This column MUST be set to one of: ERROR, WARN, INFO, DEBUG, TRACE.                                                                                                                                                                                                                                                                                                                               | REQUIRED. The client SHOULD specify one of these 5 enum values. If the value is not present, or is not one of the 5, the gateway MUST set Level to INFO.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| Name            | string                                                                                          | The "logger name" of the code emitting this metric. The client SHOULD specify a dot-separated string in the form of package.subpackage.class or directory.path.to.function that corresponds to a code location.                                                                                                                                                                                                                                  | RECOMMENDED. The gateway MUST allow ingestion of metrics with empty or ill-formed strings.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Message         | string                                                                                          | A string message intended for human consumption, e.g. console messages. The message property MAY be localized, but it is RECOMMENDED that messages be in well-formed English sentences.                                                                                                                                                                                                                                                          | RECOMMENDED for recordType "Log", and OPTIONAL for all other record types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Event           | string                                                                                          | An application-specific, enumeration style string indicating what event occurred. It is RECOMMENDED to use a machine-friendly namespace heirarchy in the form of feature.subject.verb such as shell.solutionPicker.click. Events beginning with 'exc.metrics' are reserved for metrics system use.                                                                                                                                               | REQUIRED for recordType "Event", and OPTIONAL for all other record types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Counter         | long                                                                                            | A long integer storage column, e.g. the value when recordType = PayloadCount. This column MAY also be populated when other records have relevant long integer payloads.                                                                                                                                                                                                                                                                          | REQUIRED when recordType is "PayloadCount", and OPTIONAL for all other record types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Gauge           | real                                                                                            | A real number storage column, e.g. the value when recordType = Gauge. This column MAY also be populated when other records have relevant real number payloads.                                                                                                                                                                                                                                                                                   | REQUIRED when recordType is "Gauge", and OPTIONAL for all other record types.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| WindowHRef      | string                                                                                          | Html Reference, e.g. the browser's window.location.href at the time this record was created.                                                                                                                                                                                                                                                                                                                                                     | REQUIRED for metrics emitted by browser-based applications, OPTIONAL for other applications with concepts of an window that can be represented as a URL. If present, the value MUST be parseable as an URL. The gateway MAY fail to ingest a metric with an unparseable string in the href property.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| NetworkURL      | string                                                                                          | The relevant URL for this metric. For metrics associated with network activity, this column will be the network request or response url. This column SHOULD NOT be the same as WindowHRef unless the network operation was exactly to the href.                                                                                                                                                                                                  | OPTIONAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ApplicationId   | string                                                                                          | A unique string identifier for the executable being measured. It is RECOMMENDED that the string be a colon separated artifact:version form following [SemVer](mdc:https:/semver.org) semantics, e.g. a Maven GAV or the name:version from a npm package.json file. It is RECOMMENDED that the supplied string be reasonably traceable to a git repo from which the executable was built.                                                           | A non-null string is REQUIRED in this column representing at minimum the application id/name. The gateway SHOULD allow ingestion of metrics without the version portion of the applicationId. The gateway MAY reject ingestion of metrics with a null application id.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Data            | dynamic                                                                                         | The payload of the record metric stored as a [dynamic](mdc:https:/docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/dynamic) object.                                                                                                                                                                                                                                                                                       | OPTIONAL. The Data column MUST NOT contain PII or any other data that may be subject to privacy laws. It is expensive to purge the Log table. PII may be stored only in the User table Data column for business purposes in compliance with product privacy notices.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| MetricsState    | dynamic                                                                                         | A dynamic object representing the metrics system state at the time this metric was recorded. The metrics sdk owns the content of this column. Applications MUST NOT attempt to set or override values of the MetricsState property bag.                                                                                                                                                                                                          | REQUIRED. The gateway MAY reject a metric with a missing or mal-formed metricsState property bag.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| DeviceId        | string                                                                                          | A [GUID](mdc:#guids) for the browser/operating system/machine combination for browser-based applications, or the machine for server-based applications. The DeviceId should be specific to the particular host process and machine. DeviceId SHOULD survive machine reboots, but MUST NOT survive destructive environment changes such as reinstallation of operating systems or upgrades of key components like Java VM or NodeJS version upgrades. | REQUIRED for browser-based applications. RECOMMENDED for all other applications.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| HistoryId       | string                                                                                          | A GUID for a window history entry representing a unique visit to a particular WindowHREF. A new HistoryId MUST be generated by the client each time the internal page state transitions from "done" to "active", which will be stored in this column. The SDKs SHOULD handle this generation transparently to the host application.                                                                                                              | RECOMMENDED for applications that emit a WindowHREF, and OPTIONAL for all others.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| InstanceId      | string                                                                                          | A GUID representing a unique browser tab, or a unique launch of a server application.                                                                                                                                                                                                                                                                                                                                                            | REQUIRED. The gateway MAY reject ingestion of metrics without a valid InstanceId.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| PayloadSequence | long                                                                                            | A sequentially increasing number for the micro-batch of records sent to the gateway, specific per WindowId.                                                                                                                                                                                                                                                                                                                                      | RECOMMENDED.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| UserHash        | string                                                                                          | A cryptographically strong hashed value representing a link between the Log and User tables. The value SHOULD be a SHA-256 or stronger hash.                                                                                                                                                                                                                                                                                                     | The gateway MUST generate this value from the userId, groupId and sessionId of the user information on the metric whenever it is supplied on a metric or in a payload. The client application SHOULD provide the userId, groupId and sessionId associated with the user whenever known. If the user is known to be logged out or not yet logged in, the client application MAY supply a user object with empty values for userId, groupId, and sessionId, in which case the gateway MUST apply a known constant UserHash value representing an "anonymous" user. If no user information is available, i.e. it is not know whether the user is logged in or not, then the client application MAY omit the user property bag on the metric or payload, and the gateway MUST leave the UserHash column empty for the relevant metrics. |
| WindowId        | string                                                                                          | A GUID for the window or IFrame within a tab. Each browser window object MUST be assigned a newly generated GUID at construction time, which will be destroyed when the window is destructed.                                                                                                                                                                                                                                                    | REQUIRED for all browser-based applications, RECOMMENDED for applications that have the concept of unique windows, and OPTIONAL for all other applications.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

#### Sample record of Log table: A record in Log table may look like this:

"TimeStamp": 2025-04-10T03:18:24.063Z,
"RecordType": Log,
"Offset": 00:00:22.4765000,
"Duration": ,
"Level": INFO,
"Name": quarry,
"Message": quarry.usage,
"Event": ,
"Counter": ,
"Gauge": ,
"WindowHRef": https://www5.an.adobe.com/spa/index.html?_mr=https://exc-unifiedcontent.experience.adobe.net/assets/runtime.31f34d73.js&shell_domain=experience.adobe.com&AnalyticsUI-core_version=prod20250409211008#/workspace/edit/6749140fd31ed40068ea8bcb,
"NetworkURL": ,
"ApplicationId": analytics:stage20250409225502,
"Data": {
	"event": "@quarry-connected/exl-help/ContextualHelp:1.17.1"
},
"MetricsState": {
	"sdkVersion": "@exc/metrics:1.8.0+sha.c629ca9",
	"pageState": {
		"epoch": "1687240.7000000477",
		"historyId": "68dc8c31-15ba-11f0-bd5e-05e48bb5864f",
		"state": "active"
	},
	"timeOrigin": 1744253394346.5,
	"window": {
		"iframe": true,
		"visibility": "visible",
		"location": {
			"href": "https://www5.an.adobe.com/spa/index.html?_mr=https://exc-unifiedcontent.experience.adobe.net/assets/runtime.31f34d73.js&shell_domain=experience.adobe.com&AnalyticsUI-core_version=prod20250409211008#/workspace/edit/6749140fd31ed40068ea8bcb",
			"origin": "https://www5.an.adobe.com",
			"protocol": "https:",
			"slashes": true,
			"host": "www5.an.adobe.com",
			"hostname": "www5.an.adobe.com",
			"hash": "#/workspace/edit/6749140fd31ed40068ea8bcb",
			"query": {
				"_mr": "https://exc-unifiedcontent.experience.adobe.net/assets/runtime.31f34d73.js",
				"shell_domain": "experience.adobe.com",
				"AnalyticsUI-core_version": "prod20250409211008"
			},
			"pathname": "/spa/index.html",
			"path": "/spa/index.html?_mr=https%3A%2F%2Fexc-unifiedcontent.experience.adobe.net%2Fassets%2Fruntime.31f34d73.js&shell_domain=experience.adobe.com&AnalyticsUI-core_version=prod20250409211008",
			"search": "?_mr=https://exc-unifiedcontent.experience.adobe.net/assets/runtime.31f34d73.js&shell_domain=experience.adobe.com&AnalyticsUI-core_version=prod20250409211008"
		}
	},
	"payloadSequence": 45,
	"runtimeVersion": "@exc/metrics-runtime:0.20.3+sha.c629ca9",
	"windowId": "7bd23411-15b6-11f0-bd5e-05e48bb5864f",
	"environment": "prod",
	"instanceId": "7a939990-15b6-11f0-ba2f-0b31d0ff5b50",
	"deviceId": "ff2d0441-04d9-11f0-af94-85f8df8c8141",
	"application": {
		"id": "analytics",
		"version": "stage20250409225502"
	},
	"dateReceived": 1744255117056,
	"gatewayVersion": "metricsgateway:1.0.4+sha.bb602b3",
	"ingestion": {
		"dateNow": 1744255104063,
		"region": "aus5",
		"requestId": "7hue6M67Q6bxdBnaGDTWk6iQV638yCcC"
	}
},
"DeviceId": ff2d0441-04d9-11f0-af94-85f8df8c8141,
"HistoryId": 68dc8c31-15ba-11f0-bd5e-05e48bb5864f,
"InstanceId": 7a939990-15b6-11f0-ba2f-0b31d0ff5b50,
"PayloadSequence": 45,
"UserHash": 69c0f9b15382a2a3e204c1992a39eb3bc8d82cde4608e10044136a6bb27ff6e3,
"WindowId": 7bd23411-15b6-11f0-bd5e-05e48bb5864f


#### RecordType column in Log table

Every record emitted must have a type. If a record type is not specified, it will default to 'Log' which is the most common and most general record type. The record type indicates which ADX columns will be populated and/or what kind of object is in the dynamic Data column. There are a number of [known record types](mdc:https:/git.corp.adobe.com/exc/metrics-sdk-js/blob/master/packages/metrics/src/RecordType.ts). Key types are summarized in the table below for convenience, but always refer to the code for the complete list.

Applications may create their own record types, but do not do it lightly. The criteria for creating an application-specific record type is that the dynamic Data column will contain a distict strongly-typed object, and the record type will indicate the type for that object. It is not good practice to create record types that are really just events or exceptions or system log records - use the existing types for those purposes.

#### InstanceId in Log table
InstanceId is present as a column in Log table. To apply instanceId filter on Log table, use this column to apply filter.

| Record Type      | Description                                                                                                                                                                                                                                                                                                                                                                                                 |
| ---------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Analytics        | The Data column will contain an Adobe Analytics (Omega) [DigitalData](mdc:https:/git.corp.adobe.com/exc/metrics-sdk-js/blob/master/packages/metrics/src/DigitalData.ts) object                                                                                                                                                                                                                                 |
| Event            | The Event property must contain an application-specific, enumeration style string. The recommendation is to use a machine-friendly namespace heirarchy in the form of feature.subject.verb such as shell.solutionPicker.click. Events beginning with 'exc.metrics' are reserved for metrics system use.                                                                                                     |
| History          | Reports a history change in the current window. A new HistoryId will be generated when this record is emitted, and the page loading state will be set to 'active'. The Data column will contain a [window.history](mdc:https:/developer.mozilla.org/en-US/docs/Web/API/Window/history) object.                                                                                                                 |
| Location         | Reports a location change in the current window. This metric is identical to History except that all queued metrics will be flushed immediately when this metric is emitted, and the Data column will contain the window.location object state at the time the metric was emitted.                                                                                                                          |
| Log              | The Log record type is the most common and is the default. It is expected but not required that the message property of this metric will contain a human-friendly string, which may or may not be useful for machine parsing.                                                                                                                                                                               |
| NetworkRequest   | Reports the start of a network invocation, including the url and request parameters. The Data property will contain a representation of the network Request object, e.g. as supplied by the javascript VM.                                                                                                                                                                                                  |
| NetworkResponse  | Reports the conclusion of a network invocation, which may be an HTTP status or an error. The metric's data property will contain either the Response object from the javascritp VM, or the Error returned by the network call. The event property will typically contain the HTTP response code.                                                                                                            |
| ResourceTiming   | Reports the timing results of network resource requests as reported by the Performance interface. The metric's data property will contain the ResourceTiming object supplied by the javascript VM.                                                                                                                                                                                                          |
| PaintTiming      | Reports the paint timing results as supplied by the Performance interface from the javascript VM. The PaintTiming object is stored in the metric's data property.                                                                                                                                                                                                                                           |
| NavigationTiming | Reports the timing results of navigation events emitted from the javascript VM. The NavigationTiming object is stored in the metric's data property.                                                                                                                                                                                                                                                        |
| Timer            | Reports the elapsed time between events. The timer will emit a start event at construction time, and another event for each call to time(), so it is useful for progress events. The event column will contain the corresponding timer event string. See the [Timer API](mdc:https:/git.corp.adobe.com/exc/metrics-sdk-js/blob/master/packages/metrics/src/Timer.ts) for more details.                         |
| User             | The User RecordType reports changes in the current user's login status and current effective group. This record type should not be emitted directly. Typically unified-shell will send User records internally whenever the user's state changes, e.g. login, logout, or org changes. For non-unified-shell applications, use the setUser() and clearUser() methods.                                        |
| UserEvent        | The UserEvent RecordType reports user-specific events/interactions within an application. All user events starting with 'exc.metrics' are reserved for metrics system use. The event should end with a string signifying the action/interaction e.g. 'exc.metrics.click'. UserEvents are similar to events except are geared towards user interactions with an app rather than internal application events. |

#### Directions for fetching Network response(API call details) from Log table
- For fetching data from Network response use RecordType = NetworkResponse. Status code can be fetched from Data column. For example, if you want to fetch all the network response with status code 200, you can use the below query:
```kusto
Log
| where RecordType == "NetworkResponse" and Data.status == 200
```
- For fetching failed API calls, apply filter for status code 4xx or 5xx. For example, if you want to fetch all the network response with status code 4xx, you can use the below query:
```kusto
Log
| where RecordType == "NetworkResponse" and Data.status >= 400 and Data.status < 500
```
In the query, do not use Level == "ERROR" or Level == "WARN" as these are not applicable for NetworkResponse record type. The status code is already present in the Data column.
- For RecordType = NetworkRequest, Response headers are logged in Data.headers. Request id can be found in Data.headers['x-request-id']. While printing details of API calls, print requestId as well


### User Table
User table has data aggregated from Log table. The User table is used to store user-specific information such as userId, groupId, sessionId, etc. The User table is used to store the data in a more structured way and to make it easier to query and analyze the data.

| Column Name     | [ADX Type](mdc:https:/docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types) | Description                                                                                                                                                                                                                                                                                      | Required/Notes                                                      |
| --------------- | ----------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------- |
| TimeStamp       | datetime                                                                                        | See [Log Table](mdc:#log-table) TimeStamp                                                                                                                                                                                                                                                            |                                                                     |
| DisplayName     | string                                                                                          | A human friendly display name for the logged-in user. This SHOULD be a concatenation of firstname-lastname, and MAY be locale-specific representation.                                                                                                                                           | RECOMMENDED.                                                        | - for convenience in viewing/searching |
| GroupName       | string                                                                                          | The human friendly display name for the user's current group, i.e. the name sting corresponding to groupId.                                                                                                                                                                                      | RECOMMENDED.                                                        |
| IPAddress       | string                                                                                          | A string containing IPv4 or IPv6 address of the client emitting metrics as viewed by the metrics gateway. This value MAY be used by gateway at the time of ingestion to label the user's location.                                                                                               | RECOMMENDED. This value SHOULD be determined and stored by gateway. |
| UserId          | string                                                                                          | The user's login string identifier. For IMS-based applications, this SHOULD be the user's IMS Id. For other applications this MAY be the user's login Id.                                                                                                                                        | RECOMMENDED.                                                        |
| GroupId         | string                                                                                          | The user's group identifier string. For IMS-based applications, this SHOULD be the currently selected IMS org. For non-IMS applications, this MAY be the user's currently selected group or role.                                                                                                | RECOMMENDED                                                         |
| SessionId       | string                                                                                          | A string representing the users session. For IMS-based applications, this SHOULD be the IMS sessionId. For other appications this MAY be a relevant session string such as a JSessionID.                                                                                                         | RECOMMENDED                                                         |
| Data            | dynamic                                                                                         | The payload associated with the User stored as a [dynamic](mdc:https:/docs.microsoft.com/en-us/azure/data-explorer/kusto/query/scalar-data-types/dynamic) object. This column is commonly used to store application-specific supplemental data about the user, such as the currently active tenant. | OPTIONAL                                                            |
| MetricsState    | dynamic                                                                                         | See [Log Table](mdc:#log-table) MetricsState                                                                                                                                                                                                                                                         |                                                                     |
| DeviceId        | string                                                                                          | See [Log Table](mdc:#log-table) DeviceId                                                                                                                                                                                                                                                             |                                                                     |
| InstanceId      | string                                                                                          | See [Log Table](mdc:#log-table) InstanceId                                                                                                                                                                                                                                                           |                                                                     |
| PayloadSequence | long                                                                                            | See [Log Table](mdc:#log-table) PayloadSequence                                                                                                                                                                                                                                                      |                                                                     |
| UserAgent       | string                                                                                          | See [Log Table](mdc:#log-table) UserAgent                                                                                                                                                                                                                                                            |                                                                     |
| UserHash        | string                                                                                          | See [Log Table](mdc:#log-table) UserHash                                                                                                                                                                                                                                                             |                                                                     |
| WindowId        | string                                                                                          | See [Log Table](mdc:#log-table) WindowId                                                                                                                                                                                                                                                             |                                                                     |


## Other general Info
- AppId is present in MetricState.application.id. Sometimes, it is available in MetricState.application.solution.id
- Duration column is in Day.Timespan format. Below are some examples.

| Duration | Meaning |
|------------------|------------------------------------|
| 00:10:45 | 10 minutes and 45 seconds |
| 1.02:15:00 | 1 day, 2 hours, 15 minutes |
| 00:00:00.1234567 | 123.4567 milliseconds |
| -00:05:30 | Negative duration of 5 minutes, 30s |

- Duration can be converted to seconds by: todouble(Duration)/10000000
- InstanceId is present as a column in Log table. To apply instanceId filter on Log table, use this column to apply filter.

